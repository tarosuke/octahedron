# octahedron

octahedronは正八面体の意味で、ここではスカイボックスや正距円筒、ピラミッドなどと同様に背景のためにテクスチャを正八角形に配置する方法を指す。

## ジオメトリ

テクスチャ上で以下のような場合

|     |     |     |
| --- | --- | --- |
| A   | B   | C   |
| D   | E   | F   |
| G   | H   | I   |

正八面体を上から見ると下のようになる。

|     |     |     |
| --- | --- | --- |
|     | B   |     |
| D   | X   | F   |
|     | H   |     |

なおXはACGI(E)でありACGIの頂点座標は同一で下(奥)、Eは上(手前)であるがテクスチャ座標はそれぞれ異なる。

ポリゴンは右回りでABD,CFB,IFH,GHD,EDB,EBF,EFH,EHDの8つになるのでこれをあらかじめ定数として用意しておく。

正方形テクスチャを余すところなく使え、距離の比も倍とあまり大きくはなく、かつピラミッドのような異方性は持たないが、直接にはハードウェアによるレンダリングも撮影もできないのが特徴。

UV座標は0.5拡張で使う。繰り返しは不要。

## ツール

octahedronテクスチャはレンダリングも撮影もできないのでその作成には他の形式から変換する必要がある。

### Outクラス

テクスチャ座標(符号なし整数)から空間中のベクトルを求め、これをInオブジェクトに要求して色を得て色を画像に格納する。

まず正八面体をZ=0へ投影した面へのテクスチャ平面からの写像を考えると、シンプルにテクスチャ平面の端を角が中心に重なるように折り返したものになる。

各象限はその性質が同一になるのでさらにここは第一象限に絞って考えることにする。原点側と反対側、つまり折り返す側に分けられ、折り返される場合は(X,Y)が(1-Y,1-X)に写像される。これでZ=0の平面上の点Pへ写像できることになる。

次に高さであるが、X-Pを通る直線と折り返しの直線の交点Qの高さが0、Xでは1あるいは-1であるのでPとQの比を求めれば良い。PとQは同一直線状なので媒介変数表現であれば逆数の解を得られるであろう。

Pの鉛直線上かつ正八面体上の点Rが求まったので、これをInクラスへ与えて色を得る。

### Inクラス

空間中のベクトルから元画像のテクスチャ座標(実数)を求め、元画像から色を拾う。
